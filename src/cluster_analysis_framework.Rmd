---
title: "Cluster Analysis"
output: html_document
date: "2024-10-29"
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

```

#Implement pseudocode on cod data
```{r}
Pop1 <- read.csv("/work/lotterhos/2020_CodGenomes_Inversions/outputs/Pop1_INV.csv")
Pop1.PCA <- Pop1[Pop1$PROGRAM=="PCA", ] #Stored just in case; for now, doing overlap test without PCA
Pop1 <- subset(Pop1, Pop1$PROGRAM != "PCA")
Pop1 <- Pop1[order(Pop1$CHROM, Pop1$POS_MINUS_CI),]

#For-loop - start pos
Pop1.chr1 <- Pop1[Pop1$CHROM == "NC_044048.1", ]
Pop1.chr1$LABEL <- paste(Pop1.chr1$INDIVIDUAL,Pop1.chr1$POS_MINUS_CI,Pop1.chr1$END_PLUS_CI, sep="_")
start.mat.chr1 <- matrix(ncol = nrow(Pop1.chr1), nrow = nrow(Pop1.chr1))
colnames(start.mat.chr1) <- Pop1.chr1$LABEL
rownames(start.mat.chr1) <- Pop1.chr1$LABEL

for (i in 1:nrow(Pop1.chr1)) {
  for (j in 1:nrow(Pop1.chr1)) {
    I1_lower <- Pop1.chr1$POS_MINUS_CI[i]
    I1_upper <- Pop1.chr1$POS_PLUS_CI[i]
    
    I2_lower <- Pop1.chr1$POS_MINUS_CI[j]
    I2_upper <- Pop1.chr1$POS_PLUS_CI[j]
    
    start.mat.chr1[i,j] <- if(I2_lower <= I1_lower){
      I2_upper >= I1_lower | I2_upper >= I1_upper
      } else if (I2_upper >= I1_upper){
        I2_lower <= I1_upper
        } else if (I2_upper <= I1_upper){
          I2_upper >= I1_lower
          }
  }
  
}

heatmap(start.mat.chr1*1, scale="none")

clust <- hclust(dist(start.mat.chr1*1, method="manhattan"))
str(clust) 
plot(clust)
abline(h=1.4)
cutree(clust, h=1.42)


#For-loop - end pos
end.mat.chr1 <- matrix(ncol = nrow(Pop1.chr1), nrow = nrow(Pop1.chr1))
colnames(end.mat.chr1) <- Pop1.chr1$LABEL
rownames(end.mat.chr1) <- Pop1.chr1$LABEL

for (i in 1:nrow(Pop1.chr1)) {
  for (j in 1:nrow(Pop1.chr1)) {
    I1_lower <- Pop1.chr1$END_MINUS_CI[i]
    I1_upper <- Pop1.chr1$END_PLUS_CI[i]
    
    I2_lower <- Pop1.chr1$END_MINUS_CI[j]
    I2_upper <- Pop1.chr1$END_PLUS_CI[j]
    
    end.mat.chr1[i,j] <- if(I2_lower <= I1_lower){
      I2_upper >= I1_lower | I2_upper >= I1_upper
      } else if (I2_upper >= I1_upper){
        I2_lower <= I1_upper
        } else if (I2_upper <= I1_upper){
          I2_upper >= I1_lower
          }
  }
  
}

heatmap(end.mat.chr1*1, scale="none")

clust2 <- hclust(dist(end.mat.chr1*1, method="manhattan"))
str(clust2) 
plot(clust2)
abline(h=2.1)
cutree(clust2, h=1.42)

#bestcutree - look into this

mat.dist <- dist(start.mat.chr1*1)
str(mat.dist)
summary(mat.dist)
heatmap(dist(start.mat.chr1*1), scale="none")
```

##Pseudocode

```{r overlap test}
#I1 confidence intervals
I1_lower <- 100
I1_upper <- 200

#I1 = I2 - should return true
I2_lower <- 100
I2_upper <- 200
##Success

#I2 overlapping upstream test - should return true
I2_lower <- 150
I2_upper <- 250
##Success

#I2 not overlapping upstream test - should return false
I2_lower <- 225
I2_upper <- 275
##Success

#I2 overlapping downstream test - should return true
I2_lower <- 50
I2_upper <- 150
##Success

#I2  not overlapping downstream test - should return false
I2_lower <- 25
I2_upper <- 75
##Success

#I2 within I1 test - should return true
I2_lower <- 125
I2_upper <- 175
##Success

#I1 within I2 test - should return true
I2_lower <- 75
I2_upper <- 225
##Success

#CI overlap test
if(I2_lower <= I1_lower){
  I2_upper >= I1_lower | I2_upper >= I1_upper
  } else if (I2_upper >= I1_upper){
  I2_lower <= I1_upper
  } else if (I2_upper <= I1_upper){
    I2_upper >= I1_lower
  }

```

```{r matrix and clustering algorithm}
mat <- matrix(0,5,5)
mat[1:3, 1:3] <- 1
mat[4:5, 4:5] <- 1

clust <- hclust(dist(mat), method="median")
str(clust) 
plot(clust)
cutree(clust, h=1)

```
